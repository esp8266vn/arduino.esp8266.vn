

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Cập nhật firmware &mdash; Tài liệu Lập trình IoT với ESP8266 Arduino 1.0</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Tìm Kiếm" href="../search.html"/>
    <link rel="top" title="Tài liệu Lập trình IoT với ESP8266 Arduino 1.0" href="../index.html"/>
        <link rel="next" title="ESP8266 Arduino Flappy bird" href="../projects/flappy-bird.html"/>
        <link rel="prev" title="CoAP" href="coap.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Lập trình IoT với ESP8266 Arduino
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Cơ bản</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../basic/index.html">Cài đặt</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../basic/install.html">Cài đặt Arduino IDE</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../basic/install.html#cai-dat-voi-boards-manager">Cài đặt với Boards Manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic/install.html#su-dung-git-version">Sử dụng git version</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../basic/board.html">Board IoT WiFi Uno</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../basic/board.html#pinout">Pinout</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic/board.html#thuc-te">Thực tế</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic/board.html#mach-nguyen-ly">Mạch nguyên lý</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic/board.html#fritzing-part">Fritzing part</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic/board.html#mua-hang">Mua hàng</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../basic/connection.html">Kết nối máy tính</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../basic/connection.html#ket-noi-phan-cung">Kết nối phần cứng</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic/connection.html#cai-dat-usb-driver">Cài đặt USB Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic/connection.html#cau-hinh-ket-noi">Cấu hình kết nối</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../basic/library.html">Cài đặt thư viện</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../basic/library.html#cac-thuc-hien">Các thực hiện</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic/library.html#video-huong-dan">Video hướng dẫn</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../basic/led.html">Chuẩn bị</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic/led.html#dau-noi">Đấu nối</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic/led.html#chop-tat-dung-delay">Chớp tắt dùng Delay</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic/led.html#chop-tat-dung-dinh-thoi">Chớp tắt dùng định thời</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic/led.html#digital-io">Digital IO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic/button.html">Nút nhấn</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../basic/button.html#demo">Demo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basic/button.html#chuan-bi">Chuẩn bị</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basic/button.html#dau-noi">Đấu nối</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basic/button.html#code">Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basic/button.html#digital-io">Digital IO</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../basic/promem.html">Sử dụng Promem</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../basic/promem.html#vi-du">Ví dụ</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../peripherals/index.html">Ngoại vi</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../peripherals/serial.html"> Serial/UART</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../peripherals/serial.html#hardware-serial">Hardware Serial</a></li>
<li class="toctree-l3"><a class="reference internal" href="../peripherals/serial.html#software-serial">Software Serial</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../peripherals/analog.html"> Analog/ADC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../peripherals/analog.html#ngo-ra-analog">Ngõ ra Analog</a></li>
<li class="toctree-l3"><a class="reference internal" href="../peripherals/analog.html#vi-du">Ví dụ</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../peripherals/timming.html"> Thời gian/Timer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../peripherals/timming.html#ticker">Ticker</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../peripherals/i2c.html"> I2C/OLED</a></li>
<li class="toctree-l2"><a class="reference internal" href="../peripherals/i2s.html"> I2S</a></li>
<li class="toctree-l2"><a class="reference internal" href="../peripherals/spi.html"> SPI</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../wifi/index.html">Wi-Fi</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../wifi/wifi-api.html">WiFi API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../wifi/station.html">WiFi Station</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../wifi/station.html#khai-niem-co-ban">Khái niệm cơ bản</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wifi/station.html#muc-luc">Mục lục</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../wifi/access-point.html">WiFi Access Point</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../wifi/access-point.html#muc-luc">Mục lục</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wifi/access-point.html#ve-access-point">Về Access Point</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wifi/access-point.html#thiet-lap-mang">Thiết lập mạng</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wifi/access-point.html#quan-ly-ket-noi">Quản lý kết nối</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wifi/access-point.html#cau-hinh-mang">Cấu hình Mạng</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../wifi/smartconfig.html">Smartconfig</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../wifi/smartconfig.html#loi-ich-cua-smartconfig">Lợi ích của Smartconfig</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wifi/smartconfig.html#esp-touch">ESP Touch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wifi/smartconfig.html#demo-video">Demo Video</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wifi/smartconfig.html#esp8266-code">ESP8266 code</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../wifi/wps.html">WPS</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Network/Protocol</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="http-client.html">HTTP Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="http-server.html">HTTP Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="mqtt.html">MQTT</a><ul>
<li class="toctree-l2"><a class="reference internal" href="mqtt.html#giao-thuc-mqtt">Giao thức MQTT</a><ul>
<li class="toctree-l3"><a class="reference internal" href="mqtt.html#mqtt-la-gi">MQTT là gì</a></li>
<li class="toctree-l3"><a class="reference internal" href="mqtt.html#publish-subscribe">Publish, subscribe</a></li>
<li class="toctree-l3"><a class="reference internal" href="mqtt.html#qos">QoS</a></li>
<li class="toctree-l3"><a class="reference internal" href="mqtt.html#retain">Retain</a></li>
<li class="toctree-l3"><a class="reference internal" href="mqtt.html#lwt">LWT</a></li>
<li class="toctree-l3"><a class="reference internal" href="mqtt.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="mqtt.html#chuong-trinh">Chương trình</a><ul>
<li class="toctree-l3"><a class="reference internal" href="mqtt.html#noi-dung">Nội dung</a></li>
<li class="toctree-l3"><a class="reference internal" href="mqtt.html#id1">Chương trình</a></li>
<li class="toctree-l3"><a class="reference internal" href="mqtt.html#demo">Demo</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="websocket.html">Websocket</a></li>
<li class="toctree-l1"><a class="reference internal" href="mdns.html">mDNS</a></li>
<li class="toctree-l1"><a class="reference internal" href="coap.html">CoAP</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Cập nhật firmware</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#gioi-thieu-ota">Giới thiệu OTA</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#bao-mat">Bảo mật</a></li>
<li class="toctree-l3"><a class="reference internal" href="#an-toan">An toàn</a></li>
<li class="toctree-l3"><a class="reference internal" href="#yeu-cau-can-ban">Yêu cầu căn bản</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#arduino-ide">Arduino IDE</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#yeu-cau">Yêu cầu</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vi-du-ung-dung">Ví dụ ứng dụng</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bao-mat-password">Bảo mật Password</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="#web-browser">Web Browser</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Yêu cầu</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tong-quan">Tổng quan</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ung-dung-vi-du">Ưng dụng ví dụ:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#http-server">HTTP Server</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">Yêu cầu</a></li>
<li class="toctree-l3"><a class="reference internal" href="#arduino-code">Arduino code</a></li>
<li class="toctree-l3"><a class="reference internal" href="#simple-updater">Simple updater</a></li>
<li class="toctree-l3"><a class="reference internal" href="#advanced-updater">Advanced updater</a></li>
<li class="toctree-l3"><a class="reference internal" href="#server-request-handling">Server request handling</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">Simple updater</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">Advanced updater</a></li>
<li class="toctree-l3"><a class="reference internal" href="#stream-interface">Stream Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#updater-class">Updater class</a></li>
<li class="toctree-l3"><a class="reference internal" href="#update-process-memory-view">Update process - memory view</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Dự án</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../projects/flappy-bird.html">Game Flappy Bird</a></li>
<li class="toctree-l1"><a class="reference internal" href="../projects/heart-rate.html">Đo nhịp tim</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../projects/heart-rate.html#demo">Demo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/heart-rate.html#chuan-bi">Chuẩn bị</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/heart-rate.html#dau-noi">Đấu nối</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/heart-rate.html#cai-dat-thu-vien">Cài đặt thư viện</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/heart-rate.html#video-cai-dat">Video Cài đặt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/heart-rate.html#lap-trinh">Lập trình</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/heart-rate.html#luu-y">Lưu ý</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../projects/onewire.html">Cảm biến nhiệt độ (onewire)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../projects/onewire.html#demo">Demo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/onewire.html#chuan-bi">Chuẩn bị</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/onewire.html#dau-noi">Đấu nối</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/onewire.html#cai-dat-thu-vien">Cài đặt thư viện</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/onewire.html#lap-trinh">Lập trình</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/onewire.html#luu-y">Lưu ý</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../projects/dht11-thingspeak.html">Đo nhiệt độ độ ẩm và gởi lên Thingspeak</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../projects/dht11-thingspeak.html#demo">Demo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/dht11-thingspeak.html#chuan-bi">Chuẩn bị</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/dht11-thingspeak.html#dau-noi">Đấu nối</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/dht11-thingspeak.html#cai-dat-thu-vien">Cài đặt thư viện</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/dht11-thingspeak.html#lap-trinh">Lập trình</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/dht11-thingspeak.html#luu-y">Lưu ý</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../projects/sensor-photodiode.html">Photodiode</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../projects/sensor-photodiode.html#demo">Demo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/sensor-photodiode.html#chuan-bi">Chuẩn bị</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/sensor-photodiode.html#dau-noi">Đấu nối</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/sensor-photodiode.html#cai-dat-thu-vien">Cài đặt thư viện</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/sensor-photodiode.html#lap-trinh">Lập trình</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../projects/sensor-voice.html">Cảm biến âm thanh</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../projects/sensor-voice.html#demo">Demo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/sensor-voice.html#chuan-bi">Chuẩn bị</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/sensor-voice.html#dau-noi">Đấu nối</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/sensor-voice.html#bang-dau-noi">Bảng đấu nối</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/sensor-voice.html#cai-dat-thu-vien">Cài đặt thư viện</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/sensor-voice.html#video-cai-dat">Video Cài đặt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/sensor-voice.html#lap-trinh">Lập trình</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/sensor-voice.html#luu-y">Lưu ý</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../projects/PIR.html">Cảm biến chuyển động HC-SR501</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../projects/PIR.html#demo">Demo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/PIR.html#chuan-bi">Chuẩn bị</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/PIR.html#dau-noi">Đấu nối</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/PIR.html#cai-dat-thu-vien">Cài đặt thư viện</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/PIR.html#lap-trinh">Lập trình</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/PIR.html#luu-y">Lưu ý</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../projects/BMP280.html">Cảm biến áp suất BMP280</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../projects/BMP280.html#demo">Demo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/BMP280.html#chuan-bi">Chuẩn bị</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/BMP280.html#dau-noi">Đấu nối</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/BMP280.html#cai-dat-thu-vien">Cài đặt thư viện</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/BMP280.html#lap-trinh">Lập trình</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/BMP280.html#luu-y">Lưu ý</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../projects/4led7seg.html">Led 7 đoạn 4 số</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../projects/4led7seg.html#demo">Demo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/4led7seg.html#chuan-bi">Chuẩn bị</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/4led7seg.html#dau-noi">Đấu nối</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/4led7seg.html#cai-dat-thu-vien">Cài đặt thư viện</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/4led7seg.html#lap-trinh">Lập trình</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../projects/led-matrix-max7219.html">Hiển thị ký tự với module led matrix MAX7219</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../projects/led-matrix-max7219.html#demo">Demo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/led-matrix-max7219.html#chuan-bi">Chuẩn bị</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/led-matrix-max7219.html#dau-noi">Đấu nối</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/led-matrix-max7219.html#cai-dat-thu-vien">Cài đặt thư viện</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/led-matrix-max7219.html#lap-trinh">Lập trình</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/led-matrix-max7219.html#luu-y">Lưu ý</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../projects/led-3mau-rgb.html">Moudule led 3 màu RGB</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../projects/led-3mau-rgb.html#demo">Demo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/led-3mau-rgb.html#chuan-bi">Chuẩn bị</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/led-3mau-rgb.html#dau-noi">Đấu nối</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/led-3mau-rgb.html#lap-trinh">Lập trình</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/led-3mau-rgb.html#luu-y">Lưu ý</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../projects/joystick.html">Đọc dữ liệu từ Joystick</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../projects/joystick.html#demo">Demo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/joystick.html#chuan-bi">Chuẩn bị</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/joystick.html#huong-dan">Hướng dẫn</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/joystick.html#dau-noi">Đấu nối</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/joystick.html#cai-dat-thu-vien">Cài đặt thư viện</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/joystick.html#lap-trinh">Lập trình</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/joystick.html#luu-y">Lưu ý</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../projects/led-12.html">Vòng 12 LED RGB</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../projects/led-12.html#demo">Demo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/led-12.html#chuan-bi">Chuẩn bị</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/led-12.html#dau-noi">Đấu nối</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/led-12.html#cai-dat-thu-vien">Cài đặt thư viện</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/led-12.html#lap-trinh">Lập trình</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/led-12.html#luu-y">Lưu ý</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../projects/servo-motor.html">Động cơ servo</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../projects/servo-motor.html#demo">Demo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/servo-motor.html#chuan-bi">Chuẩn bị</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/servo-motor.html#dau-noi">Đấu nối</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/servo-motor.html#cai-dat-thu-vien">Cài đặt thư viện</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/servo-motor.html#video-cai-dat">Video Cài đặt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/servo-motor.html#lap-trinh">Lập trình</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/servo-motor.html#luu-y">Lưu ý</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../projects/color-sensor.html">Cảm biến màu sắc</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../projects/color-sensor.html#demo">Demo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/color-sensor.html#chuan-bi">Chuẩn bị</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/color-sensor.html#dau-noi">Đấu nối</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/color-sensor.html#cai-dat-thu-vien">Cài đặt thư viện</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/color-sensor.html#video-cai-dat">Video Cài đặt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/color-sensor.html#lap-trinh">Lập trình</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/color-sensor.html#luu-y">Lưu ý</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../projects/rain-sensor.html">Cảm biến mưa</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../projects/rain-sensor.html#demo">Demo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/rain-sensor.html#chuan-bi">Chuẩn bị</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/rain-sensor.html#dau-noi">Đấu nối</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/rain-sensor.html#cai-dat-thu-vien">Cài đặt thư viện</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/rain-sensor.html#lap-trinh">Lập trình</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../projects/keypad4x4.html">Ma trận phím 4x4</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../projects/keypad4x4.html#demo">Demo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/keypad4x4.html#chuan-bi">Chuẩn bị</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/keypad4x4.html#dau-noi">Đấu nối</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/keypad4x4.html#cai-dat-thu-vien">Cài đặt thư viện</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/keypad4x4.html#video-cai-dat">Video Cài đặt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/keypad4x4.html#lap-trinh">Lập trình</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/keypad4x4.html#luu-y">Lưu ý</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Tài liệu ESP8266</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://espressif.com/sites/default/files/documentation/esp8266-technical_reference_en.pdf">Technical Reference Manual (PDF)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://espressif.com/sites/default/files/documentation/0d-esp8266_pin_list_release_15-11-2014.xlsx">Pin List and Functions (XLSX)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://espressif.com/en/products/hardware/esp8266ex/resources">Tài nguyên chính thống</a></li>
</ul>
<p class="caption"><span class="caption-text">Đóng góp và bản quyền</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Hướng dẫn đóng góp</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../contributing.html#cai-dat-cong-cu-can-thiet">Cài đặt công cụ cần thiết</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributing.html#viet-bai">Viết bài</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributing.html#mot-so-luu-y-khac">Một số lưu ý khác</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributing.html#danh-sach-cac-thanh-vien-da-dong-gop">Danh sách các thành viên đã đóng góp</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Lập trình IoT với ESP8266 Arduino</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Cập nhật firmware</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/network/ota.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="cap-nhat-firmware">
<h1>Cập nhật firmware<a class="headerlink" href="#cap-nhat-firmware" title="Permalink to this headline">¶</a></h1>
<div class="section" id="gioi-thieu-ota">
<h2>Giới thiệu OTA<a class="headerlink" href="#gioi-thieu-ota" title="Permalink to this headline">¶</a></h2>
<p>Cập nhật firmware OTA (Over the Air) là tiến trình tải firmware mới vào
ESP module thay vì sử dụng cổng Serial. Tính năng này thực sự rất hữu
dụng trong nhiều trường hợp giới hạn về kết nối vật lý đến ESP Module.</p>
<p>OTA có thể thực hiện với:</p>
<ul class="simple">
<li><a class="reference internal" href="#arduino-ide0"><span class="std std-ref">Arduino IDE</span></a></li>
<li><a class="reference internal" href="#web-browser0"><span class="std std-ref">Web Browser</span></a></li>
<li><a class="reference internal" href="#http-server0"><span class="std std-ref">HTTP Server</span></a></li>
</ul>
<p>Sử dụng OTA với tùy chọn dùng <strong>Arduino IDE</strong> trong quá trình phát
triển, thử nghiệm, 2 tùy chọn còn lại phù hợp cho việc triển khai ứng
dụng thực tế, cung cấp tính năng cập nhật OTA thông qua web hay sử dụng
HTTP Server.</p>
<p>Trong tất cả các trường hợp, thì Firmware hỗ trợ OTA phải được nạp lần
đầu tiên qua cổng Serial, nếu mọi thứ hoạt động trơn tru, logic ứng dụng
OTA hoạt động đúng thì có thể thực hiện việc cập nhật firmware thông qua
OTA.</p>
<p>Sẽ không có đảm bảo an ninh đối với quá trình cập nhật OTA bị hack. Nó
phụ thuộc vào nhà phát triển đảm bảo việc cập nhật được phép từ nguồn
hợp pháp, đáng tin cậy. Khi cập nhật hoàn tất, ESP8266 sẽ khởi động lại
và thực thi code mới. Nhà phát triển phải đảm bảo ứng dụng thực trên
module phải được tắt và khởi động lại 1 cách an toàn. Nội dung bên dưới
cung cấp bổ sung các thông tin về an ninh, và an toàn cho tiến trình cập
nhật OTA.</p>
<div class="section" id="bao-mat">
<h3>Bảo mật<a class="headerlink" href="#bao-mat" title="Permalink to this headline">¶</a></h3>
<p>Khi ESP8266 được phép thực thi OTA, có nghĩa nó được kết nối mạng không
dây và có khả năng được cập nhập Sketch mới. Cho nên khả năng ESP8266 bị
tấn công sẽ nhiều hơn và bị nạp bởi mã thực thi khác là rất cao. Để giảm
khả năng bị tấn công cần xem xét bảo vệ cập nhật của bạn với một mật
khẩu, cổng sử dụng cố định khác biệt, v.v…</p>
<p>Kiểm tra những tính năng được cung cấp bởi thư viện <a class="reference external" href="https://github.com/esp8266/Arduino/tree/master/libraries/ArduinoOTA">ArduinoOTA</a> thường
xuyên, có thể được nâng cấp khả năng bảo vệ an toàn:</p>
<div class="code cpp highlight-default"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">setPort</span><span class="p">(</span><span class="n">uint16_t</span> <span class="n">port</span><span class="p">);</span>
<span class="n">void</span> <span class="n">setHostname</span><span class="p">(</span><span class="n">const</span> <span class="n">char</span><span class="o">*</span> <span class="n">hostname</span><span class="p">);</span>
<span class="n">void</span> <span class="n">setPassword</span><span class="p">(</span><span class="n">const</span> <span class="n">char</span><span class="o">*</span> <span class="n">password</span><span class="p">);</span>
</pre></div>
</div>
<p>Một số chức năng bảo vệ đã được xây dựng trong và không yêu cầu bất kỳ
mã hóa nào cho nhà phát triển. <a class="reference external" href="https://github.com/esp8266/Arduino/tree/master/libraries/ArduinoOTA">ArduinoOTA</a> và <code class="docutils literal"><span class="pre">espota.py</span></code> sử dụng
<a class="reference external" href="https://en.wikipedia.org/wiki/Digest_access_authentication">Digest-MD5</a> để chứng thực việc tải firmware lên. Đơn giản là đảm bảo
tính toàn vẹn của firmware bằng việc tính <a class="reference external" href="https://en.wikipedia.org/wiki/MD5">MD5</a>.</p>
<p>Hãy phân tích rủi ro cho riêng ứng dụng của bạn và tùy thuộc vào ứng
dụng mà quyết định những chức năng cũng như thư viện để thực hiện. Nếu
cần thiết, có thẻ xem xét việc thực hiện các phương thức bảo vệ khỏi bị
hack, ví dụ như cập nhật OTA chỉ cho tải lên chỉ theo lịch trình cụ thể,
kích hoạt OTA chỉ được người dùng nhấn nút chuyên dụng “Cập nhật”, v.v…</p>
</div>
<div class="section" id="an-toan">
<h3>An toàn<a class="headerlink" href="#an-toan" title="Permalink to this headline">¶</a></h3>
<p>Quá trình OTA tiêu tốn nguồn tài nguyên và băng thông của ESP8266 khi
tải lên. Sau đó, ESP8266 được khởi động lại và một Sketch mới được thực
thi. Cần phân tích và kiểm tra ảnh hưởng của quá trình này tới các chức năng cũ và sketch mới của ESP module.</p>
<p>Nếu ESP được đặt ở xa và điều khiển một vài thiết bị, ta nên chú ý tới hoạt động của thiết bị nếu thiết bị ngừng hoạt động đột xuất do   quá trình cập nhật. Do đó, ta cần phải xác định được trạng thái làm việc an toàn của thiết bị trước quá trình cập nhật. Ví dụ, module được dùng để điều khiển hệ thống tưới nước tự động trong vườn. Nếu trong quá trình hoạt động mà hệ thống điều khiển bị tắt đột ngột và các van bị mở, thì cả vườn sẽ bị ngập nước.</p>
<p>Các hàm sau đây được cung cấp bởi thư viện <a class="reference external" href="https://github.com/esp8266/Arduino/tree/master/libraries/ArduinoOTA">ArduinoOTA</a> và được dùng để xử lý ứng dụng trong quá trình cập nhật OTA hoặc để xử lý khi OTA gặp lỗi:</p>
<div class="code cpp highlight-default"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">onStart</span><span class="p">(</span><span class="n">OTA_CALLBACK</span><span class="p">(</span><span class="n">fn</span><span class="p">));</span>
<span class="n">void</span> <span class="n">onEnd</span><span class="p">(</span><span class="n">OTA_CALLBACK</span><span class="p">(</span><span class="n">fn</span><span class="p">));</span>
<span class="n">void</span> <span class="n">onProgress</span><span class="p">(</span><span class="n">OTA_CALLBACK_PROGRESS</span><span class="p">(</span><span class="n">fn</span><span class="p">));</span>
<span class="n">void</span> <span class="n">onError</span><span class="p">(</span><span class="n">OTA_CALLBACK_ERROR</span> <span class="p">(</span><span class="n">fn</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="yeu-cau-can-ban">
<h3>Yêu cầu căn bản<a class="headerlink" href="#yeu-cau-can-ban" title="Permalink to this headline">¶</a></h3>
<p>Bộ nhớ Flash phải có đủ dung lượng để lưu cả sketch cũ (đang vận hành trên hệ thống) và sketch mới (cập nhật OTA).</p>
<p>Hệ thống File và EEPROM cũng cần dung lượng để lưu trữ. Xem <a href="#id8"><span class="problematic" id="id9">`flash layout`_</span></a> .</p>
<p>Hàm</p>
<div class="code cpp highlight-default"><div class="highlight"><pre><span></span><span class="n">ESP</span><span class="o">.</span><span class="n">getFreeSketchSpace</span><span class="p">();</span>
</pre></div>
</div>
<p>được dùng để kiểm tra dung lượng trống cho sketch mới.</p>
<p>Để tìm hiểu tống quát về memory layout, nơi mà new sketch được lưu và quá trình copy nó trong quá trình cập nhật OTA,xem <a class="reference internal" href="#update-process-memory-view">Update process - memory view</a>.</p>
<p>Các phần sau trình bày chi tiết và các phương pháp cụ thể để thưc hiện OTA.</p>
</div>
</div>
<div class="section" id="arduino-ide">
<span id="arduino-ide0"></span><h2>Arduino IDE<a class="headerlink" href="#arduino-ide" title="Permalink to this headline">¶</a></h2>
<p>Thưc hiện OTA với module Arduino IDE chỉ được thưc hiện trong các trường hợp điển hình sau: -trong lúc firmware đang hoạt động để thay thế việc sử dụng cổng nối tiếp, - khi cập nhật ít cho modules, -chỉ khi module Arduino IDE và máy tính đang ờ trong cùng một mạng.</p>
<div class="section" id="yeu-cau">
<h3>Yêu cầu<a class="headerlink" href="#yeu-cau" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div>ESP và máy tính phải được kết nối cùng một mạng.</div></blockquote>
</div>
<div class="section" id="vi-du-ung-dung">
<h3>Ví dụ ứng dụng<a class="headerlink" href="#vi-du-ung-dung" title="Permalink to this headline">¶</a></h3>
<p>Các hướng dẫn sau trình bày cách cấu hình OTA trên board NodeMCU 1.0 (ESP-12E Module). Ta có thể dùng các board khác nếu chúng thỏa các yêu cầu trình bảy ở trên. Hướng dẫn này thích hợp với các hệ điều hành hỗ trợ Arduino IDE.
Các hình ảnh hướng dẫn thực hiện trên Win7 và bạn có thể gặp một số khác biệt nhỏ (như tên của các cổng nối tiếp), nếu dùng Linux hoặc MacOS if you are using Linux and MacOS.</p>
<blockquote>
<div><blockquote>
<div><ol class="arabic">
<li><p class="first">Trước khi bắt đầu, ta phải cài đặt đầy đủ các phần mềm sau:</p>
<blockquote>
<div><p>Arduino IDE 1.6.7 hoặc bản mới nhất - <a class="reference external" href="https://www.arduino.cc/en/Main/Software">Latest version</a></p>
<p>esp8266/Arduino platform package 2.0.0 hoặc bản mới nhất - và làm theo hướng dẫn: <a class="reference external" href="https://github.com/esp8266/Arduino#installing-with-boards-manager">See link</a></p>
<p>Python 2.7 - <a class="reference external" href="https://www.python.org/">Download Python</a></p>
<p><strong>Chú ý</strong>: Người dùng Windows nên chọn “Add python.exe to Path” (xem hình bên dưới – lựa chọn này không phải là lựa chọn mặc định)</p>
<img alt="../_images/win7.png" src="../_images/win7.png" />
</div></blockquote>
</li>
</ol>
</div></blockquote>
<ol class="arabic" start="2">
<li><p class="first">Bây giờ, ta chuẩn bị sketch và cấu hình cho việc upload qua cổng nối tiếp:</p>
<blockquote>
<div><p>Mở Arduino IDE và load sketch BasicOTA.ino. Vào File &gt; Examples &gt; ArduinoOTA.</p>
<blockquote>
<div><img alt="../_images/00.png" src="../_images/00.png" />
</div></blockquote>
<p>Cập nhật SSID và password trong sketch để module có thể truy cập WIFI.</p>
<blockquote>
<div><img alt="../_images/01.png" src="../_images/01.png" />
</div></blockquote>
<p>Cấu hình thông số upload như bên dưới (bạn cần điều chỉnh cấu hình cho phù hơp nếu dùng module khác):</p>
<blockquote>
<div><img alt="../_images/02.png" src="../_images/02.png" />
</div></blockquote>
<p><strong>Chú ý</strong>: Tùy vào phiên bản và board ESP bạn sử dụng, bạn có thể thấy <code class="docutils literal"><span class="pre">Upload</span> <span class="pre">Using:</span></code> trong menu. Lựa chọn này sẽ không hoạt động và không ảnh hưởng tới lựa chọn của bạn. Chức năng này tương thích với các phiên bản OTA cũ và bỉ gỡ bỏ ở platform package version 2.2.0.</p>
</div></blockquote>
</li>
<li><p class="first">Upload sketch (Ctrl+U). Khi hoàn thành, mở Serial Monitor (Ctrl+Shift+M) và kiểm tra module đã trup cập được WIFI chưa:</p>
</li>
</ol>
<blockquote>
<div><img alt="../_images/03.png" src="../_images/03.png" />
</div></blockquote>
</div></blockquote>
<p><strong>Chú ý</strong>: ESP module nên được reset sau khi upload xong after. Nếu không thì các bước tiếp theo sẽ không thưc hiện được. Reset có thể được tự động thưc hiện sau khi ta mở màn hình nối tiếp như ở hình trên.  Nó phụ thuộc vào cách ta kết nối DTR và RTS từ USB-Serial tới ESP. Nếu phần mềm không reset tự động, thì ta phải ấn nút rest trên board. Để hiểu rõ hơn, cần tìm hiểu hàm <code class="docutils literal"><span class="pre">ESP.restart()</span></code>.</p>
<blockquote>
<div><ol class="arabic" start="4">
<li><p class="first">Khi module được kết nối tới mạng, sau vài giây, cổng esp8266-ota sẽ mở trên Arduino IDE. Chọn port với địa chỉ IP hiện trên cửa sổ Serial Monitor ở bước trước.</p>
<blockquote>
<div><img alt="../_images/04.png" src="../_images/04.png" />
</div></blockquote>
</li>
</ol>
<blockquote>
<div><strong>Chú ý</strong>: Nếu cổng OTA không hiện lên, thoát Arduino IDE, và mở lại. Kiểm tra lại port OTA. Nếu vẫn tiếp tục không hiển thị cổng OTA, kiểm tra tưòng lửa của máy và các cài đặt trên router.</div></blockquote>
<p>5.Chọn cổng OTA:</p>
<blockquote>
<div><blockquote>
<div><img alt="../_images/ota-upload-configuration.png" src="../_images/ota-upload-configuration.png" />
</div></blockquote>
<p><strong>Chú ý</strong>: Mục <code class="docutils literal"><span class="pre">Upload</span> <span class="pre">Speed</span></code> ở hình trên: Gĩư gía trị này không đổi do nó liên quan tới cổng nối tiếp.</p>
<ol class="arabic simple" start="6">
<li>Nếu bạn đã thực hiện các bước trên thành công, bạn có thể upload (Ctrl+U) sketch qua OTA.</li>
</ol>
<img alt="../_images/ota-upload-complete.png" src="../_images/ota-upload-complete.png" />
</div></blockquote>
</div></blockquote>
<p><strong>Chú ý</strong>: Để có thể upload sketch nhiều lần qua OTA, bạn cần nhúng (embed) lịch OTA vào phầm mềm. Dùng BasicOTA.ino để làm ví dụ.</p>
</div>
<div class="section" id="bao-mat-password">
<h3>Bảo mật Password<a class="headerlink" href="#bao-mat-password" title="Permalink to this headline">¶</a></h3>
<p>Bảo vệ quá trình upload OTA với password là một quá trình khá đơn gỉản. Những việc bạn cần làm là dán đoạn code sau vào đoạn code của bạn:</p>
<div class="code cpp highlight-default"><div class="highlight"><pre><span></span><span class="n">ArduinoOTA</span><span class="o">.</span><span class="n">setPassword</span><span class="p">((</span><span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="p">)</span><span class="s2">&quot;123&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Trong đó &quot;123&quot; làn một password ví dụ. Thay &quot;123&quot; bằng password của bạn.</p>
<p>Trước khi thực hiện việc này, ta cùng tìm hiểu cách sử dụng sketch BasicOTA.ino. BasicOTA.ino có thể truy xuất bằng đường dẫn: File &gt; Examples &gt; ArduinoOTA. Mở         BasicOTA.ino, bỏ các comment có sẵn trong file và upload sketch. Để việc troubleshooting dễ hơn, không sửa đổi sketch ví dụ, gồm cả sketch OTA password (như với password 123 lúc nãy). Sau đó upload lại sketch một lần nữa (dùng OTA). Sau khi biên dịch và upload xong, cửa sổ sẽ hiện lên yêu cầu nhập password như hình:</p>
<blockquote>
<div><img alt="../_images/pass00.png" src="../_images/pass00.png" />
</div></blockquote>
<p>Nhập password và upload như bình thường. Nếu nhập đúng, và chạy thành công,kết quả là thông báo``Authenticating...OK`` trên màn hình</p>
<blockquote>
<div><img alt="../_images/pass01.png" src="../_images/pass01.png" />
</div></blockquote>
<p>Lần này bạn sẽ không được nhắc yêu cầu phải nhập lại password cho lần sau. Arduino IDE sẽ nhớ password cho bạn. Bạn sẽ nhận được thông báo nhắc nhập lại password khi bạn mở lại IDE hoặc nếu bạn thay đổi password trong sketch và upload sketch và sau đó upload lại một lần nữa.</p>
<p>Cần lưu ý là password cũ có thể bị lộ, nếu IDE không được đóng sau lần upload cuối cùng. Việc này có thể được thực hiện bằng cách cho phép <em>Show verbose ouput during: upload</em> trong <em>File -&gt; Preferences</em> và upload lên module.</p>
<blockquote>
<div><img alt="../_images/pass02.png" src="../_images/pass02.png" />
</div></blockquote>
<p>Từ hình trên ta có thể thấy password trên log, do nó được đưa tới <strong>espota.py</strong> upload script</p>
<p>Password cũng có thể bị thay đổi trong khi đang upload như ở hình dưới dây:</p>
<blockquote>
<div><img alt="../_images/pass03.png" src="../_images/pass03.png" />
</div></blockquote>
<p>Ơ hình trên ta thấy, trong khi upload, Arduino IDE dùng password cũ, do đó việc upload bị thất bại (upload failed) và bị report bởi IDE. Chỉ khi IDE yêu cầu bạn nhập password mới và khi nhập đúng thì việc upload mới thành công.</p>
</div>
</div>
<div class="section" id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h2>
<p>Nếu việc cập nhật OTA thất bại, bước đầu tiên bạn cần làm là kiểm tra tin nhắn báo lỗi (error message) hiện trên cửa sổ upload của Arduino IDE. Nếu việc này không gíup được bạn, hãy upload lại khi kiểm tra các thông tin của ESP hiện trên serial port, Serial Monitor từ IDE sẽ không hữu ích trong trường hợp này. Khi cố sử dụng nó, màn hình sau sẽ hiển thị:</p>
<blockquote>
<div><img alt="../_images/troubleshoot01.png" src="../_images/troubleshoot01.png" />
</div></blockquote>
<p>Đây là cửa sổ cho Arduino Ýun và không được thực hiện trên ESP8266. Cửa sổ xưất hiện do IDE cố mở Serial Monitor dùng cổng mạng mà bạn đã chọn cho OTA upload.</p>
<p>Thay vào đó, bạn cần một Serial monitor ngoài. Nếu bạn đang sử dụng Windows, hãy sử dụng <a class="reference external" href="https://www.compuphase.com/software_termite.htm">Terminal</a> . Đây là một cổng RS232 đơn gỉan mà không đòi hỏi điều khiển dòng RTS và DTR. Hai dạng điều khiển dòng này có thể gây ra vấn đề nếu ta đang sử dụng các đường dây cắm theo thứ tự để thay đổi GPIO và chân RESET trên ESP để upload.</p>
<p>Chọn cổng COM và baud rate trên cổng ngoài nếu bạn dùng Arduino Serial Monitor. Chọn cài đặt chuẩn cho Termite như hình sau:</p>
<blockquote>
<div><img alt="../_images/troubleshoot02.png" src="../_images/troubleshoot02.png" />
</div></blockquote>
<p>Sau đó chạy OTA từ IDE và theo dõi kết quả hiển thị trên cổng. Quá trình ArduinoOTA thành công dùng BasicOTA.ino sketch như hình dưới
(Địa chỉ IP tùy thuộc vào cấu hình mạng của máy bạn)</p>
<blockquote>
<div><img alt="../_images/troubleshoot03.png" src="../_images/troubleshoot03.png" />
</div></blockquote>
<p>Nếu upload thất bại, bạn sẽ thấy các lỗi báo về từ IDE, từ các lỗi ngoại lệ (exception) và stack trace (như thiếu cấu trúc try ... catch hoặc throws trong lập trình Java/Android)</p>
<p>Nhưng khác với ở các trường hợp trên khi lỗi được hiển thị trên màn hình compile của IDE, lỗi lần này được hiển thị như hình sau:</p>
<blockquote>
<div><img alt="../_images/troubleshoot04.png" src="../_images/troubleshoot04.png" />
</div></blockquote>
<p>Trong trường hợp này, phần lớn các module ESP đều không được reset sau lần upload đầu dùng serial port (như các thao tác đã trình bày ở phần Arduino IDE ở trên)</p>
<p>Các nguyên nhân phổ biến gây lỗi OTA như sau:</p>
<ul class="simple">
<li>Không đủ dung lượng bộ nhớ trên chip (ví dụ như ESP01 với 512KB bộ nhớ flash không đủ cho OTA).</li>
<li>Quá nhiều khai báo bộ nhớ cho SPIFFS nên sketch mới sẽ không phù hợp gĩư sketch và SPIFFS (xem lại Giới thiệu về OTA, quá trình update).</li>
<li>Quá ít khai báo bộ nhớ trong Arduino IDE để3 bạn lựa chọn (tức là ít hơn kích thước vật lý).</li>
<li>Không reset module ESP sau lần upload đầu dùng serial port.</li>
</ul>
</div>
<div class="section" id="web-browser">
<span id="web-browser0"></span><h2>Web Browser<a class="headerlink" href="#web-browser" title="Permalink to this headline">¶</a></h2>
<p>Việc cập nhật được mô tả trong phần này được thực hiện với một web browser. Việc này có thể hữu ích trong các trường hợp sau:
*       Sau khi cài đặt ứng dụng nếu tải trực tiếp từ Arduino IDE không thuận tuận hoặc không thể tải được do sự cố nào đó
*       Sau khi cài đặt ứng dụng nếu người dùng không thể update OTA bằng các server update ngoài.
*       Để update một phần nhỏ lên thiết bị sau khi cài đặt khi cài đặt update server không thực tế.</p>
<div class="section" id="id1">
<h3>Yêu cầu<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Module ESP và máy tính phải được kết nối cùng một mạng.</p>
</div>
<div class="section" id="tong-quan">
<h3>Tổng quan<a class="headerlink" href="#tong-quan" title="Permalink to this headline">¶</a></h3>
<p>Cập nhật với web browser được thực hiện bằng lớp <code class="docutils literal"><span class="pre">ESP8266HTTPUpdateServer</span></code> cùng với 2 lớp: <code class="docutils literal"><span class="pre">ESP8266WebServer</span></code> và <code class="docutils literal"><span class="pre">ESP8266mDNS</span></code></p>
<p>Code:</p>
<div class="code cpp highlight-default"><div class="highlight"><pre><span></span>    <span class="n">setup</span><span class="p">()</span>

<span class="n">MDNS</span><span class="o">.</span><span class="n">begin</span><span class="p">(</span><span class="n">host</span><span class="p">);</span>

<span class="n">httpUpdater</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="o">&amp;</span><span class="n">httpServer</span><span class="p">);</span>
<span class="n">httpServer</span><span class="o">.</span><span class="n">begin</span><span class="p">();</span>

<span class="n">MDNS</span><span class="o">.</span><span class="n">addService</span><span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">,</span> <span class="s2">&quot;tcp&quot;</span><span class="p">,</span> <span class="mi">80</span><span class="p">);</span>

<span class="n">loop</span><span class="p">()</span>

<span class="n">httpServer</span><span class="o">.</span><span class="n">handleClient</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="ung-dung-vi-du">
<h3>Ưng dụng ví dụ:<a class="headerlink" href="#ung-dung-vi-du" title="Permalink to this headline">¶</a></h3>
<p>Để thực hiện ví dụ, bạn cần:</p>
<ul class="simple">
<li>Sketch ví dụ WebUpdater.ino trong thư viện ESP8266HTTPUpdateServer.</li>
<li>NodeMCU 1.0 (ESP-12E Module).</li>
</ul>
<p>Bạn cũng có thể dùng module khác nếu nó thõa yêu cầu trên</p>
<ol class="arabic">
<li><p class="first">Để bắt đầu, bạn cần phải có đủ các phần mềm sau đây:</p>
<blockquote>
<div><p>Arduino IDE và phiên bản 2.0.0-rc1 (of Nov 17, 2015): <a class="reference external" href="https://github.com/esp8266/Arduino#installing-with-boards-manager">Download</a></p>
<dl class="docutils">
<dt>Host software tùy thuộc vào hệ điều hành bạn sử dụng:</dt>
<dd><p class="first last">Avahi với Linux: <a class="reference external" href="http://avahi.org/">Download Avahi</a>
Bonjour với Windows <a class="reference external" href="http://www.apple.com/support/bonjour/">Download Bonjour</a>
Mac OSX và iOS: đã có hỗ trợ sẵn trên Hệ điều hành</p>
</dd>
</dl>
</div></blockquote>
</li>
<li><p class="first">Chuẩn bị sketch và cấu hình cho lần upload đầu với cổng nối tiếp.</p>
</li>
</ol>
<ul>
<li><p class="first">Mở Arduino IDE và load sketch WebUpdater.ino (nàm ở File &gt; Examples &gt; ESP8266HTTPUpdateServer).</p>
</li>
<li><p class="first">Update SSID and password vào sketch để cho module có thể truy cập WIFI.</p>
</li>
<li><p class="first">Mở File &gt; Preferences, tìm “Show verbose output during:” và ấn chọn “compilation”.</p>
<blockquote>
<div><img alt="../_images/webbrowser0.png" src="../_images/webbrowser0.png" />
</div></blockquote>
</li>
</ul>
<blockquote>
<div>Chú ý: Việc chọn cài đặt compilation này cũng được yêu cầu tương tự ở 5 bước sau. Bạn có thể không chọn &quot;compilation&quot; ở các bước sau.</div></blockquote>
<ol class="arabic" start="3">
<li><p class="first">Upload sketch (Ctrl+U). Khi thực hiện xong, mở Serial Monitor (Ctrl+Shift+M) và kiểm tra nếu bạn thấy các tin nhắn như hình sau, bao gồm cả URL cho cập nhật OTA</p>
<blockquote>
<div><blockquote>
<div><img alt="../_images/webbrowser01.png" src="../_images/webbrowser01.png" />
</div></blockquote>
<p>Chú ý: Những tin nhắn này chỉ hiển thị khi module đã truy cập được WIFI và sẵn sàng upload OTA. Cũng giống như với module Arduino IDE, sau khi upload xong thì ta phải reset lại module.</p>
</div></blockquote>
<ol class="arabic" start="4">
<li><p class="first">Sau đó mở web browser lên và paste URL ở trên (i.e. <a class="reference external" href="http://esp8266-webupdate.local/update">http://esp8266-webupdate.local/update</a>). Sau khi thưc hiện xong, browser sẽ có dạng như hình dưới. Bạn có thể chọn file để update.</p>
<blockquote>
<div><img alt="../_images/webbrowser03.png" src="../_images/webbrowser03.png" />
</div></blockquote>
</li>
</ol>
<blockquote>
<div><p>Chú ý: Khi đã nhập <a class="reference external" href="http://esp8266-webupdate.local/update">http://esp8266-webupdate.local/update</a> mà không thưc hiện được, hãy thay  esp8266-webupdate với module địa chỉ IP. Ví dụ, nếu IP của module là 192.168.1.100 thì URL phải là <a class="reference external" href="http://192.168.1.100/update">http://192.168.1.100/update</a>. Phương pháp này hữu hiệu trong trường hợp host software cài đặt ở bước 1 không hoạt động. Nếu vẫn không thưc hiện được nữa và Serial Monitor cũng không có tin nhắn cảnh báo nào thì bạn có thể tự tìm lỗi bằng cách mở URL được cung cấp trên Google Chrome, ấn F12 và kiểm tra nội dụng trong tab &quot;Console&quot; và &quot;Network&quot;. Google sẽ cung cấp nhiều tính năng hỗ trợ ở các tab này.</p>
</div></blockquote>
<ol class="arabic" start="5">
<li><p class="first">Để có được file, ta chuyển folder làm việc tới folder của Arduino IDE để lưu kết quả biên dịch. Ta có thể kiểm tra đường dẫn tới file sau khi xem kết quả biên dịch như ở hình dưới.</p>
<blockquote>
<div><img alt="../_images/webbrowser04.png" src="../_images/webbrowser04.png" />
</div></blockquote>
</li>
</ol>
</li>
</ol>
<p>Bây giờ chọn &quot;Choose File&quot; trong web browser, đến nơi lưu file làm việc như đã trình bày ở bước 5, tìm file &quot;WebUpdater.cpp.bin&quot; và upload lên. Nếu upload thành công, ta sẽ có kết quả như hình dưới.</p>
<blockquote>
<div><blockquote>
<div><img alt="../_images/webbrowser05.png" src="../_images/webbrowser05.png" />
</div></blockquote>
<p>Kết quả reboot có thể thấy trên cửa sổ Serial Monitor như hình dưới:</p>
<blockquote>
<div><img alt="../_images/webbrowser06.png" src="../_images/webbrowser06.png" />
</div></blockquote>
</div></blockquote>
<p>Sau khi reboot, ta sẽ nhận được tin nhắn <code class="docutils literal"><span class="pre">HTTPUpdateServer</span> <span class="pre">ready!</span> <span class="pre">Open</span> <span class="pre">http://</span> <span class="pre">esp8266-webupdate.local</span> <span class="pre">/update</span> <span class="pre">in</span> <span class="pre">your</span> <span class="pre">browser</span></code> như ở bước 3, bởi vì module được load lại bằng code cũ (dùng serial port), sau đó dùng OTA.</p>
<blockquote>
<div>Sau khi bạn đã quen với các bước thưc hiện này, ta có thể điều chỉnh WebUpdater.ino sketch và xuất ra các tin nhắn theo ý muốn, sau đó biên dịch chương trình, sau đó upload file biên dịch dùng Web browser. Kết quả sẽ hiển thị trên Serial Monitor.</div></blockquote>
<p>Ta cũng có thể lên kế hoạch update OTA trong sketch, như hướng dẫn Tổng quan ở trên. Nếu thưc hiện đúng, ta có thể dùng web browser upload sketch mới như là bản cập nhật mới, bên cạnh sketch cũ đã update.</p>
<p>Trong trường hợp update OTA thất bại sau khi đã sửa đổi sketch, ta có thể khôi phục lại module bằng cách load lại sketch cũ đã upload. Sau đó debug lỗi sketch dùng Serial Monitor. Sau khi sửa lỗi xong thì update OTA lại,</p>
</div>
</div>
<div class="section" id="http-server">
<span id="http-server0"></span><h2>HTTP Server<a class="headerlink" href="#http-server" title="Permalink to this headline">¶</a></h2>
<p>Lớp''ESPhttpUpdate'' có thể dùng để kiểm tra các update và download một file dạng nhị phân từ HTTP web server. Ta có thể download các update từ mọi địa chỉ IP hoặc tên miền trên Internet.</p>
<div class="section" id="id2">
<h3>Yêu cầu<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>web server</li>
</ul>
</div>
<div class="section" id="arduino-code">
<h3>Arduino code<a class="headerlink" href="#arduino-code" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="simple-updater">
<h3>Simple updater<a class="headerlink" href="#simple-updater" title="Permalink to this headline">¶</a></h3>
<p>Simple updater sẽ download file mỗi khi hàm được gọi.</p>
<p><code class="docutils literal"><span class="pre">ESPhttpUpdate.update(&quot;192.168.0.2&quot;,</span> <span class="pre">80,</span> <span class="pre">&quot;/arduino.bin&quot;);</span></code></p>
</div>
<div class="section" id="advanced-updater">
<h3>Advanced updater<a class="headerlink" href="#advanced-updater" title="Permalink to this headline">¶</a></h3>
<p>Ta cũng có thể gọi hàm update bằng một đoạn script trên server. Nếu ta có đối số của version, nó sẽ được gởi lên server. Phía server sẽ dùng nó để kiểm tra xem đã đủ điều kiện thực hiện update được chưa.</p>
<p>Script trên server có các kết quả trả về như:</p>
<ul class="simple">
<li>(Mã) 200: Yêu cầu gởi hình ảnh firmware.</li>
<li>(Mã) 304: Thông báo là không có bản update mới.</li>
</ul>
<div class="code cpp highlight-default"><div class="highlight"><pre><span></span>    <span class="n">t_httpUpdate_return</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">ESPhttpUpdate</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s2">&quot;192.168.0.2&quot;</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="s2">&quot;/esp/update/arduino.php&quot;</span><span class="p">,</span> <span class="s2">&quot;optional current version string here&quot;</span><span class="p">);</span>

<span class="n">switch</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="p">{</span>
<span class="n">case</span> <span class="n">HTTP_UPDATE_FAILED</span><span class="p">:</span>
   <span class="n">Serial</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">&quot;[update] Update failed.&quot;</span><span class="p">);</span>
   <span class="k">break</span><span class="p">;</span>
<span class="n">case</span> <span class="n">HTTP_UPDATE_NO_UPDATES</span><span class="p">:</span>
   <span class="n">Serial</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">&quot;[update] Update no Update.&quot;</span><span class="p">);</span>
   <span class="k">break</span><span class="p">;</span>
<span class="n">case</span> <span class="n">HTTP_UPDATE_OK</span><span class="p">:</span>
   <span class="n">Serial</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">&quot;[update] Update ok.&quot;</span><span class="p">);</span> <span class="o">//</span> <span class="n">may</span> <span class="ow">not</span> <span class="n">called</span> <span class="n">we</span> <span class="n">reboot</span> <span class="n">the</span> <span class="n">ESP</span>
   <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="server-request-handling">
<h3>Server request handling<a class="headerlink" href="#server-request-handling" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="id3">
<h3>Simple updater<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>Với simple updater, server chỉ cần file nhị phân để update.</p>
</div>
<div class="section" id="id4">
<h3>Advanced updater<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>Với advanced update thì script phải chạy trên server, ví dụ như một PHP script. Mỗi lần yêu cầu update, ESP sẽ gởi thông tin lên qua giao thức HTTP bằng các HTTP header tới server.</p>
<p>Ví dụ về header data:</p>
<div class="code cpp highlight-default"><div class="highlight"><pre><span></span>    <span class="p">[</span><span class="n">HTTP_USER_AGENT</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="n">ESP8266</span><span class="o">-</span><span class="n">http</span><span class="o">-</span><span class="n">Update</span>
    <span class="p">[</span><span class="n">HTTP_X_ESP8266_STA_MAC</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">18</span><span class="p">:</span><span class="n">FE</span><span class="p">:</span><span class="n">AA</span><span class="p">:</span><span class="n">AA</span><span class="p">:</span><span class="n">AA</span><span class="p">:</span><span class="n">AA</span>
    <span class="p">[</span><span class="n">HTTP_X_ESP8266_AP_MAC</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="n">A</span><span class="p">:</span><span class="n">FE</span><span class="p">:</span><span class="n">AA</span><span class="p">:</span><span class="n">AA</span><span class="p">:</span><span class="n">AA</span><span class="p">:</span><span class="n">AA</span>
<span class="p">[</span><span class="n">HTTP_X_ESP8266_FREE_SPACE</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">671744</span>
<span class="p">[</span><span class="n">HTTP_X_ESP8266_SKETCH_SIZE</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">373940</span>
<span class="p">[</span><span class="n">HTTP_X_ESP8266_SKETCH_MD5</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="n">a56f8ef78a0bebd812f62067daf1408a</span>
<span class="p">[</span><span class="n">HTTP_X_ESP8266_CHIP_SIZE</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">4194304</span>
<span class="p">[</span><span class="n">HTTP_X_ESP8266_SDK_VERSION</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mf">1.3</span><span class="o">.</span><span class="mi">0</span>
<span class="p">[</span><span class="n">HTTP_X_ESP8266_VERSION</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="n">DOOR</span><span class="o">-</span><span class="mi">7</span><span class="o">-</span><span class="n">g14f53a19</span>
</pre></div>
</div>
<p>Với các thông tin cung cấp thì script có thể kiểm tra nếu có thể update được. Ta cũng có thể làm tương tự với địa chỉ MAC khi yêu cầu update:</p>
<p>Script ví dụ (Với địa chỉ MAC):</p>
<div class="code cpp highlight-default"><div class="highlight"><pre><span></span>    &lt;?PHP

header(&#39;Content-type: text/plain; charset=utf8&#39;, true);

function check_header($name, $value = false) {
if(!isset($_SERVER[$name])) {
   return false;
}
if($value &amp;&amp; $_SERVER[$name] != $value) {
   return false;
}
return true;
}

function sendFile($path) {
header($_SERVER[&quot;SERVER_PROTOCOL&quot;].&#39; 200 OK&#39;, true, 200);
header(&#39;Content-Type: application/octet-stream&#39;, true);
header(&#39;Content-Disposition: attachment; filename=&#39;.basename($path));
header(&#39;Content-Length: &#39;.filesize($path), true);
header(&#39;x-MD5: &#39;.md5_file($path), true);
readfile($path);
}

if(!check_header(&#39;HTTP_USER_AGENT&#39;, &#39;ESP8266-http-Update&#39;)) {
header($_SERVER[&quot;SERVER_PROTOCOL&quot;].&#39; 403 Forbidden&#39;, true, 403);
echo &quot;only for ESP8266 updater!\n&quot;;
exit();
}

if(
!check_header(&#39;HTTP_X_ESP8266_STA_MAC&#39;) ||
!check_header(&#39;HTTP_X_ESP8266_AP_MAC&#39;) ||
!check_header(&#39;HTTP_X_ESP8266_FREE_SPACE&#39;) ||
!check_header(&#39;HTTP_X_ESP8266_SKETCH_SIZE&#39;) ||
!check_header(&#39;HTTP_X_ESP8266_SKETCH_MD5&#39;) ||
!check_header(&#39;HTTP_X_ESP8266_CHIP_SIZE&#39;) ||
!check_header(&#39;HTTP_X_ESP8266_SDK_VERSION&#39;)
) {
header($_SERVER[&quot;SERVER_PROTOCOL&quot;].&#39; 403 Forbidden&#39;, true, 403);
echo &quot;only for ESP8266 updater! (header)\n&quot;;
exit();
}

$db = array(
&quot;18:FE:AA:AA:AA:AA&quot; =&gt; &quot;DOOR-7-g14f53a19&quot;,
&quot;18:FE:AA:AA:AA:BB&quot; =&gt; &quot;TEMP-1.0.0&quot;
);

if(!isset($db[$_SERVER[&#39;HTTP_X_ESP8266_STA_MAC&#39;]])) {
header($_SERVER[&quot;SERVER_PROTOCOL&quot;].&#39; 500 ESP MAC not configured for updates&#39;, true, 500);
}

$localBinary = &quot;./bin/&quot;.$db[$_SERVER[&#39;HTTP_X_ESP8266_STA_MAC&#39;]].&quot;.bin&quot;;

// Check if version has been set and does not match, if not, check if
    // MD5 hash between local binary and ESP8266 binary do not match if not.
    // then no update has been found.
    if((!check_header(&#39;HTTP_X_ESP8266_SDK_VERSION&#39;) &amp;&amp; $db[$_SERVER[&#39;HTTP_X_ESP8266_STA_MAC&#39;]] != $_SERVER[&#39;HTTP_X_ESP8266_VERSION&#39;])
|| $_SERVER[&quot;HTTP_X_ESP8266_SKETCH_MD5&quot;] != md5_file($localBinary)) {
sendFile($localBinary);
} else {
header($_SERVER[&quot;SERVER_PROTOCOL&quot;].&#39; 304 Not Modified&#39;, true, 304);
    }

header($_SERVER[&quot;SERVER_PROTOCOL&quot;].&#39; 500 no version for ESP MAC&#39;, true, 500);
</pre></div>
</div>
</div>
<div class="section" id="stream-interface">
<h3>Stream Interface<a class="headerlink" href="#stream-interface" title="Permalink to this headline">¶</a></h3>
<p>The Stream Interface dựa trên các mode update khác đã trình bày ở trên như OTA, HTTP server/client.</p>
</div>
<div class="section" id="updater-class">
<h3>Updater class<a class="headerlink" href="#updater-class" title="Permalink to this headline">¶</a></h3>
<p>Updater nằm trong Core và dùng để xử lí việc viết firmware lên flash, kiểm tra tính thống nhất của nó và thông báo bootloader để load firmware trên boot kế tiếp.</p>
</div>
<div class="section" id="update-process-memory-view">
<h3>Update process - memory view<a class="headerlink" href="#update-process-memory-view" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Sketch mới sẽ được chứa trong dung lượng trống gĩưa sketch cũ và spiff will be stored in the space between the old sketch and the spiff.</p>
</li>
<li><p class="first">Trong lần reboot tiếp theo thì “eboot” bootloader kiểm tra các câu lệnh.</p>
</li>
<li><p class="first">Sketch mới sẽ được copy.</p>
</li>
<li><p class="first">Sketch mới khởi động.</p>
<blockquote>
<div><img alt="../_images/update.png" src="../_images/update.png" />
</div></blockquote>
</li>
</ul>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../projects/flappy-bird.html" class="btn btn-neutral float-right" title="ESP8266 Arduino Flappy bird" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="coap.html" class="btn btn-neutral" title="CoAP" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, TuanPM.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0',
            LANGUAGE:'vi',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/translations.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-60470603-9");
pageTracker._trackPageview();
} catch(err) {}</script>


</body>
</html>